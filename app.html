<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Subari Hotel â€” Rooms</title>
<style>
  :root{
    --green:#22c55e; --yellow:#facc15; --red:#ef4444; --gray:#9ca3af; --purple:#a855f7;
  }
  *{box-sizing:border-box}
  body{margin:0;background:#ffffff;color:#222;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
  header{position:sticky;top:0;background:#fff;border-bottom:1px solid #eee;padding:10px 14px;display:flex;align-items:center;gap:10px;z-index:5}
  .brand{display:flex;gap:10px;align-items:center}
  .badge{width:32px;height:32px;border-radius:50%;overflow:hidden;border:1px solid #eee;background:#fafafa}
  .badge img{width:100%;height:100%;object-fit:cover}
  .sp{flex:1}
  .btn{padding:8px 12px;border-radius:10px;border:0;background:#111;color:#fff;font-weight:800;cursor:pointer}
  .btn-outline{padding:8px 12px;border-radius:10px;background:#fff;border:1px solid #ddd;color:#111;cursor:pointer}
  .toolbar{display:flex;gap:8px;align-items:center;background:#fff;border-bottom:1px solid #eee;padding:10px 14px;justify-content:center}
  .toolbar input{width:min(420px,80vw);padding:10px;border-radius:10px;border:1px solid #ddd}
  /* Center grid */
  .wrap{display:grid;place-items:start;justify-content:center;padding:16px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(160px, 1fr));gap:14px;max-width:1100px}
  .card{background:#fff;border:1px solid #eee;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,.05);padding:12px;display:flex;flex-direction:column;gap:8px;min-height:150px}
  .stripe{height:6px;border-radius:6px;margin:-6px -6px 6px}
  .room{font-weight:900}
  .foot{font-size:12px;color:#666}
  .row{display:flex;align-items:center;gap:6px;flex-wrap:wrap}
  dialog{border:1px solid #ddd;border-radius:14px;background:#fff;color:#222;max-width:720px;width:min(720px,96vw);}
  dialog .hd{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border-bottom:1px solid #eee}
  dialog form{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;padding:12px 14px}
  dialog label{font-size:12px;color:#666}
  dialog input, dialog select, dialog textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #ddd;background:#fff}
  .full{grid-column:1/-1}
  .right{display:flex;gap:8px;justify-content:flex-end;padding:12px 14px;border-top:1px solid #eee}
</style>
</head>
<body>
<header>
  <div class="brand">
    <div class="badge"><img src="assets/logo.png" alt=""></div>
    <div><div style="font-size:12px;color:#666">Subari Hotel</div><div style="font-weight:800">Rooms</div></div>
  </div>
  <div class="sp"></div>
  <button id="newBtn" class="btn">+ Add Room</button>
  <button id="logoutBtn" class="btn-outline">Sign out</button>
</header>

<div class="toolbar">
  <input id="q" placeholder="Search room / guest / phone">
  <button class="btn-outline" data-filter="all">All</button>
  <button class="btn-outline" data-filter="green">In-House</button>
  <button class="btn-outline" data-filter="yellow">Reserved</button>
  <button class="btn-outline" data-filter="gray">Vacant</button>
  <button class="btn-outline" data-filter="red">Dirty</button>
  <button class="btn-outline" data-filter="purple">Out of Order</button>
</div>

<div class="wrap"><div class="grid" id="grid"></div></div>

<dialog id="dlg">
  <div class="hd">
    <div id="dlgTitle">Room</div>
    <button id="xBtn" class="btn-outline">Ã—</button>
  </div>
  <form id="frm">
    <div>
      <label>Room</label>
      <input name="roomNumber" required placeholder="101">
    </div>
    <div>
      <label>Status</label>
      <select name="status">
        <option value="gray">Vacant</option>
        <option value="yellow">Reserved</option>
        <option value="green">In-House</option>
        <option value="red">Dirty</option>
        <option value="purple">Out of Order</option>
      </select>
    </div>
    <div>
      <label>Guest</label>
      <input name="guest" placeholder="Full name">
    </div>
    <div>
      <label>Phone</label>
      <input name="phone" placeholder="+964">
    </div>
    <div>
      <label>Car No.</label>
      <input name="car" placeholder="plate">
    </div>
    <div>
      <label>Persons</label>
      <input type="number" min="1" value="1" name="persons">
    </div>
    <div>
      <label>Nights</label>
      <input type="number" min="1" value="1" name="nights">
    </div>
    <div>
      <label>Rate (IQD)</label>
      <input type="number" min="0" step="1000" value="0" name="rate">
    </div>
    <div>
      <label>Paid?</label>
      <select name="paid">
        <option value="unpaid">Unpaid</option>
        <option value="paid">Paid</option>
      </select>
    </div>
    <div>
      <label>Method</label>
      <select name="method">
        <option>Cash</option>
        <option>Card</option>
        <option>Bank</option>
      </select>
    </div>
    <div class="full">
      <label>Notes</label>
      <textarea name="notes" rows="2"></textarea>
    </div>
    <div class="full" style="font-size:12px;color:#444">
      <strong>Total IQD: <span id="total">0</span> â€” <span id="left">Unpaid</span></strong>
    </div>
  </form>
  <div class="right">
    <button id="invoiceBtn" class="btn-outline">Invoice</button>
    <button id="saveBtn" class="btn">Save</button>
  </div>
</dialog>

<script>
const KEY='subari_rooms_classic';
let rooms = JSON.parse(localStorage.getItem(KEY)||'[]');
function save(){ localStorage.setItem(KEY, JSON.stringify(rooms)); }
function money(x){ return Number(x||0).toLocaleString('en-IQ'); }
function color(status){
  return {green:'var(--green)',yellow:'var(--yellow)',red:'var(--red)',gray:'var(--gray)',purple:'var(--purple)'}[status]||'#ddd';
}

const grid = document.getElementById('grid');
const q = document.getElementById('q');
let filter='all';
document.querySelectorAll('[data-filter]').forEach(b=> b.onclick=()=>{ filter=b.dataset.filter; render(); });
q.addEventListener('input', render);

function render(){
  const term=(q.value||'').toLowerCase();
  grid.innerHTML='';
  const list = rooms
    .filter(r=> filter==='all' ? true : r.status===filter)
    .filter(r=>{
      const s = (r.roomNumber+' '+(r.guest||'')+' '+(r.phone||'')).toLowerCase();
      return s.includes(term);
    })
    .sort((a,b)=>(a.roomNumber||'').localeCompare(b.roomNumber||''));
  for(const r of list){
    const card=document.createElement('div'); card.className='card';
    const stripe=document.createElement('div'); stripe.className='stripe'; stripe.style.background=color(r.status||'gray');
    const room=document.createElement('div'); room.className='room'; room.textContent='Room '+(r.roomNumber||'');
    const row=document.createElement('div'); row.className='row';
    if(r.guest) row.innerHTML+=`<span>ðŸ‘¤ ${r.guest}</span>`;
    if(r.persons) row.innerHTML+=`<span>â€¢ ðŸ‘¥ ${r.persons}</span>`;
    if(r.nights) row.innerHTML+=`<span>â€¢ ðŸ›Œ ${r.nights}</span>`;
    if(r.rate) row.innerHTML+=`<span>â€¢ ðŸ’µ ${money(r.rate)}</span>`;
    const foot=document.createElement('div'); foot.className='foot';
    foot.textContent = (r.paid==='paid'?'Paid':'Unpaid') + (r.method?(' â€¢ '+r.method):'');
    const btns=document.createElement('div'); btns.className='row';
    const open=document.createElement('button'); open.className='btn-outline'; open.textContent='Open'; open.onclick=()=>openDlg(r);
    const clean=document.createElement('button'); clean.className='btn-outline'; clean.textContent='Mark Clean'; clean.onclick=()=>{ r.status='gray'; save(); render(); };
    btns.append(open, clean);
    card.append(stripe, room, row, foot, btns);
    grid.append(card);
  }
}

const dlg=document.getElementById('dlg');
const frm=document.getElementById('frm');
const total=document.getElementById('total');
const left=document.getElementById('left');
let current=null;

function openDlg(obj){
  current=obj || {status:'gray',persons:1,nights:1,rate:0,paid:'unpaid',method:'Cash'};
  for(const el of frm.elements){ if(el.name){ el.value = current[el.name]??''; } }
  calc();
  dlg.showModal();
}
document.getElementById('newBtn').onclick = ()=>openDlg(null);
document.getElementById('xBtn').onclick = ()=>dlg.close();
frm.addEventListener('input', calc);

function calc(){
  const f=Object.fromEntries(new FormData(frm).entries());
  const tot=(+f.nights||0)*(+f.rate||0);
  total.textContent = money(tot);
  left.textContent = (f.paid==='paid') ? 'Paid' : 'Unpaid';
}

document.getElementById('saveBtn').onclick=()=>{
  const f=Object.fromEntries(new FormData(frm).entries());
  if(!f.roomNumber) return alert('Room number is required');
  if(!current.id){ current.id=Date.now(); rooms.push(current); }
  Object.assign(current, f, {persons:+f.persons||1, nights:+f.nights||1, rate:+f.rate||0});
  save(); render(); dlg.close();
};

document.getElementById('invoiceBtn').onclick=()=>{
  const f=Object.fromEntries(new FormData(frm).entries());
  const nights=+f.nights||0, rate=+f.rate||0, tot=nights*rate;
  const html=`<html><head><meta charset="utf-8"><title>Invoice â€” Room ${f.roomNumber}</title>
  <style>body{font-family:system-ui;padding:24px} h1{margin:0 0 8px} table{width:100%;border-collapse:collapse}
  td,th{border:1px solid #ddd;padding:8px;text-align:left} .r{text-align:right}</style></head>
  <body>
  <h1>Invoice</h1>
  <div>${f.guest||''}</div><div>Room ${f.roomNumber||''}</div><hr/>
  <table><thead><tr><th>Description</th><th>Qty</th><th>Total</th></tr></thead>
  <tbody><tr><td>${nights} night(s) @ ${money(rate)} IQD</td><td class="r">${nights}</td><td class="r">${money(tot)}</td></tr></tbody></table>
  <h3>Grand Total: ${money(tot)} IQD</h3>
  <div>Amount Paid: ${f.paid==='paid'?'Paid':'Unpaid'}</div>
  <div>Method: ${f.method||'-'}</div>
  </body></html>`;
  const w=window.open('about:blank','_blank'); w.document.write(html); w.document.close();
};

// auth
document.getElementById('logoutBtn').onclick=()=>{ localStorage.removeItem('subari_session_v1'); location.href='login.html'; };

// seed
if(rooms.length===0){
  rooms=[
    {roomNumber:'101', status:'gray'},
    {roomNumber:'102', status:'yellow', guest:'Ali', persons:2, nights:2, rate:50000, paid:'unpaid', method:'Cash'},
    {roomNumber:'103', status:'green', guest:'Sara', persons:1, nights:3, rate:60000, paid:'paid', method:'Card'},
    {roomNumber:'104', status:'red'}
  ];
  save();
}
render();
</script>
</body>
</html>
