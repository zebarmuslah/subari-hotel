<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Subari Hotel ‚Äî Front Desk</title>
<style>
  :root{ --green:#22c55e; --yellow:#facc15; --red:#ef4444; --gray:#9ca3af; }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Noto Sans,sans-serif;background:#fff;color:#222}
  header{padding:10px 14px;border-bottom:1px solid #eee;display:flex;align-items:center;gap:10px;flex-wrap:wrap}
  .banner{background:#e6f7e9;color:#14532d;padding:8px 12px;border-bottom:1px solid #ccefd4;font-weight:700}
  .err{display:none;background:#fee2e2;color:#991b1b;border:1px solid #fecaca;border-radius:8px;padding:10px 12px;margin:12px}
  .legend{display:flex;gap:12px;font-size:13px;color:#555}
  .chip{display:inline-flex;align-items:center;gap:6px}
  .sw{width:10px;height:10px;border-radius:3px;display:inline-block}
  .sp{flex:1}
  .btn{padding:8px 12px;border-radius:10px;border:0;background:#111;color:#fff;cursor:pointer;font-weight:800}
  .btn-outline{padding:8px 12px;border-radius:10px;background:#fff;border:1px solid #ddd;color:#111;cursor:pointer}
  .bar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;padding:10px 14px;border-bottom:1px solid #eee}
  .bar input{padding:10px;border-radius:10px;border:1px solid #ddd;min-width:260px}
  .wrap{display:grid;justify-content:center;padding:16px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px;max-width:1100px}
  .card{background:#fff;border:1px solid #eee;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,.05);padding:12px;display:flex;flex-direction:column;gap:8px;min-height:150px}
  .stripe{height:6px;border-radius:6px;margin:-6px -6px 6px}
  .room{font-weight:900}
  .foot{font-size:12px;color:#666}
  .row{display:flex;align-items:center;gap:6px;flex-wrap:wrap}
  dialog{border:1px solid #ddd;border-radius:14px;background:#fff;color:#222;max-width:820px;width:min(820px,96vw)}
  dialog .hd{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border-bottom:1px solid #eee}
  dialog form{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:12px 14px}
  dialog label{font-size:12px;color:#666}
  dialog input, dialog select, dialog textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #ddd;background:#fff}
  .full{grid-column:1/-1}
  .right{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;padding:12px 14px;border-top:1px solid #eee}
</style>
</head>
<body>
<div class="banner">‚úÖ App loaded (diagnostic)</div>
<div id="err" class="err"></div>

<header>
  <h2 style="margin:0">Front Desk Board</h2>
  <div class="sp"></div>
  <div class="legend">
    <span class="chip"><span class="sw" style="background:var(--green)"></span>In-House</span>
    <span class="chip"><span class="sw" style="background:var(--yellow)"></span>Reserved</span>
    <span class="chip"><span class="sw" style="background:var(--red)"></span>Dirty</span>
    <span class="chip"><span class="sw" style="background:var(--gray)"></span>Vacant</span>
  </div>
</header>

<div class="bar">
  <input id="q" placeholder="Search room / guest / phone">
  <button class="btn-outline" data-filter="all">All</button>
  <button class="btn-outline" data-filter="green">In-House</button>
  <button class="btn-outline" data-filter="yellow">Reserved</button>
  <button class="btn-outline" data-filter="red">Dirty</button>
  <button class="btn-outline" data-filter="gray">Vacant</button>
  <div class="sp"></div>
  <button id="addBtn" class="btn">Add room</button>
</div>

<div class="wrap"><div class="grid" id="grid"></div></div>

<dialog id="dlg">
  <div class="hd">
    <div style="font-weight:800">Room</div>
    <button id="xBtn" class="btn-outline">Close</button>
  </div>
  <form id="frm">
    <div><label>Room</label><input name="roomNumber" required placeholder="101"></div>
    <div><label>Status</label><select name="status">
      <option value="gray">Vacant</option><option value="yellow">Reserved</option>
      <option value="green">In-House</option><option value="red">Dirty</option>
    </select></div>
    <div><label>Guest</label><input name="guest" placeholder="Full name"></div>
    <div><label>Persons</label><input type="number" min="0" value="0" name="persons"></div>
    <div><label>Nights</label><input type="number" min="0" value="0" name="nights"></div>
    <div><label>Rate/night (IQD)</label><input type="number" min="0" step="1000" value="0" name="rate"></div>
    <div><label>Amount paid (IQD)</label><input type="number" min="0" step="1000" value="0" name="amountPaid"></div>
    <div><label>Paid (Arabic)</label><select name="paid"><option value="unpaid">ÿ∫Ÿäÿ± ŸÖÿØŸÅŸàÿπ</option><option value="paid">ŸÖÿØŸÅŸàÿπ</option></select></div>
    <div><label>Phone</label><input name="phone" placeholder="+964"></div>
    <div><label>Car</label><input name="car" placeholder="plate"></div>
    <div class="full"><label>Notes</label><textarea name="notes" rows="2"></textarea></div>
  </form>
  <div class="right">
    <button id="checkinBtn" class="btn-outline">Check-In</button>
    <button id="checkoutBtn" class="btn-outline">Check-Out ‚Üí Dirty</button>
    <button id="saveBtn" class="btn">Save</button>
  </div>
</dialog>

<script>
(function(){
  // ---- Error overlay: show any runtime error on the page
  const errBox = document.getElementById('err');
  function showError(msg){
    errBox.style.display='block';
    errBox.innerHTML = '<strong>JavaScript error:</strong><br>'+msg;
  }
  window.onerror = function(message, source, lineno, colno, error){
    showError(message + ' @ ' + (source||'') + ':' + lineno + ':' + colno);
    return false;
  };

  try {
    // ====== Data & helpers
    const KEY='subari_v1';
    let rooms = JSON.parse(localStorage.getItem(KEY) || '[]');
    function save(){ localStorage.setItem(KEY, JSON.stringify(rooms)); }
    function money(n){ return Number(n||0).toLocaleString('en-IQ'); }
    function color(s){ return {green:'#22c55e',yellow:'#facc15',red:'#ef4444',gray:'#9ca3af'}[s] || '#ddd'; }

    // Always include full hotel room list (101‚Äì106, 201‚Äì206, 301‚Äì306, 401‚Äì406, 501‚Äì506, 601‚Äì614 except 603)
    const ROOM_LIST = ['101','102','103','104','105','106','201','202','203','204','205','206','301','302','303','304','305','306','401','402','403','404','405','406','501','502','503','504','505','506','601','602','604','605','606','607','608','609','610','611','612','613','614'];
    function ensureAllRooms(){
      const map=new Map(rooms.map(r=>[String(r.roomNumber), r]));
      for(const n of ROOM_LIST){ if(!map.has(n)) map.set(n,{id:'seed_'+n, roomNumber:n, status:'gray'}); }
      rooms = Array.from(map.values()).sort((a,b)=>String(a.roomNumber).localeCompare(String(b.roomNumber)));
      save();
    }

    // ====== DOM
    const grid=document.getElementById('grid');
    const dlg=document.getElementById('dlg');
    const frm=document.getElementById('frm');
    const q=document.getElementById('q');
    let filter='all', current=null;

    document.querySelectorAll('[data-filter]').forEach(b=> b.onclick=()=>{ filter=b.dataset.filter; render(); });
    q.addEventListener('input', render);
    document.getElementById('addBtn').onclick = ()=>openDlg(null);
    document.getElementById('xBtn').onclick = ()=>dlg.close();

    document.getElementById('saveBtn').onclick = ()=>{
      const f=Object.fromEntries(new FormData(frm).entries());
      if(!f.roomNumber) return alert('Room number is required');
      // ensure exists
      let r = rooms.find(x=> String(x.roomNumber)===String(f.roomNumber));
      if(!r){ r={id:Date.now(), roomNumber:f.roomNumber}; rooms.push(r); }
      Object.assign(r, f, { persons:+f.persons||0, nights:+f.nights||0, rate:+f.rate||0, amountPaid:+f.amountPaid||0 });
      save(); render(); dlg.close();
    };
    document.getElementById('checkinBtn').onclick = ()=>{ if(!current) return; current.status='green'; save(); render(); dlg.close(); };
    document.getElementById('checkoutBtn').onclick = ()=>{
      if(!current) return;
      if(!confirm('Check out this room? This clears guest details and marks the room as Dirty.')) return;
      current.status='red';
      current.guest=''; current.phone=''; current.car=''; current.notes='';
      current.persons=0; current.nights=0; current.rate=0; current.amountPaid=0; current.paid='unpaid';
      save(); render(); dlg.close();
    };

    function openDlg(obj){
      current = obj || {status:'gray', persons:0, nights:0, rate:0, amountPaid:0, paid:'unpaid'};
      for(const el of frm.elements){ if(el.name){ el.value = current[el.name] ?? ''; } }
      dlg.showModal();
    }

    function render(){
      ensureAllRooms();
      const term=(q.value||'').toLowerCase();
      grid.innerHTML='';
      rooms
        .filter(r => filter==='all' ? true : r.status===filter)
        .filter(r => (String(r.roomNumber)+' '+(r.guest||'')+' '+(r.phone||'')+' '+(r.car||'')).toLowerCase().includes(term))
        .forEach(r=>{
          const card=document.createElement('div'); card.className='card';
          const stripe=document.createElement('div'); stripe.className='stripe'; stripe.style.background=color(r.status||'gray');
          const room=document.createElement('div'); room.className='room'; room.textContent='Room '+(r.roomNumber||'');
          const row=document.createElement('div'); row.className='row';
          if(r.guest) row.innerHTML+=`<span>üë§ ${r.guest}</span>`;
          if(r.persons) row.innerHTML+=`<span>‚Ä¢ üë• ${r.persons}</span>`;
          if(r.nights) row.innerHTML+=`<span>‚Ä¢ üõå ${r.nights}</span>`;
          if(r.rate) row.innerHTML+=`<span>‚Ä¢ üíµ ${money(r.rate)}</span>`;
          const total=(+r.nights||0)*(+r.rate||0);
          const balance=Math.max(0,total-(+r.amountPaid||0));
          const foot=document.createElement('div'); foot.className='foot';
          const paidText=r.paid==='paid'?'ŸÖÿØŸÅŸàÿπ':'ÿ∫Ÿäÿ± ŸÖÿØŸÅŸàÿπ';
          foot.textContent=`${paidText} ‚Ä¢ Total ${money(total)} ‚Ä¢ Balance ${money(balance)}`;
          const btns=document.createElement('div'); btns.className='row';
          const open=document.createElement('button'); open.className='btn-outline'; open.textContent='Open'; open.onclick=()=>openDlg(r);
          const clean=document.createElement('button'); clean.className='btn-outline'; clean.textContent='Mark Clean'; clean.onclick=()=>{ r.status='gray'; save(); render(); };
          btns.append(open, clean);
          card.append(stripe, room, row, foot, btns);
          grid.append(card);
        });
    }

    // Kick off
    ensureAllRooms();
    render();

  } catch(e){
    showError(e && e.stack ? e.stack : String(e));
  }
})();
</script>
</body>
</html>
