<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Subari Hotel ‚Äî App</title>
<style>
  :root{
    --gold:#d4af37; --gold2:#b9962b; --ink:#0f1115; --panel:#161a22; --line:#242a33; --muted:#98a0ad;
    --green:#23c55e; --yellow:#fbbf24; --red:#ef4444; --gray:#6b7280; --purple:#a855f7;
  }
  *{box-sizing:border-box}
  body{margin:0;background:#0f1115;color:#e9eaec;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;}
  header{position:sticky;top:0;background:#11151d;border-bottom:1px solid var(--line);padding:10px 14px;display:flex;align-items:center;gap:10px;z-index:5}
  .logo{display:flex;align-items:center;gap:10px;font-weight:900}
  .logo .badge{width:34px;height:34px;border-radius:50%;overflow:hidden;border:1px solid var(--gold)}
  .logo .badge img{width:100%;height:100%;object-fit:cover;object-position:center}
  .sp{flex:1}
  .btn{padding:8px 12px;border-radius:10px;border:0;background:linear-gradient(135deg,var(--gold),var(--gold2));color:#111;font-weight:800;cursor:pointer}
  .btn-outline{padding:8px 12px;border-radius:10px;background:transparent;border:1px solid var(--line);color:#e9eaec;cursor:pointer}
  .legend{display:flex;gap:12px;font-size:12px;color:#b4bcc8}
  .chip{display:inline-flex;align-items:center;gap:6px}
  .sw{width:10px;height:10px;border-radius:3px;display:inline-block}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px;padding:14px}
  .card{background:#0f131b;border:1px solid var(--line);border-radius:14px;padding:10px;display:flex;flex-direction:column;gap:6px}
  .room-id{font-weight:900;font-size:14px}
  .status{font-size:12px;color:#b6bdc8}
  .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  .tag{font-size:12px;padding:2px 6px;border:1px solid var(--line);border-radius:999px}
  .foot{font-size:11px;color:#9aa3af}
  dialog{border:1px solid var(--line);border-radius:16px;background:#0f131b;color:#e9eaec;max-width:720px;width:min(720px,96vw);}
  dialog .hd{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border-bottom:1px solid var(--line)}
  dialog form{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;padding:12px 14px}
  dialog label{font-size:12px;color:#9aa3af}
  dialog input, dialog select, dialog textarea{width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:#0b0f16;color:#e9eaec}
  .full{grid-column:1/-1}
  .right{display:flex;gap:8px;justify-content:flex-end;padding:12px 14px;border-top:1px solid var(--line)}
  .danger{border-color:#ef4444;color:#ef4444}
  .hidden{display:none}
</style>
</head>
<body>
<header>
  <div class="logo">
    <div class="badge"><img src="assets/logo.png" alt=""></div>
    <div><div style="font-size:12px;color:#b8c0cc">Subari Hotel</div><div style="font-weight:800">Front Desk</div></div>
  </div>
  <div class="legend">
    <span class="chip"><span class="sw" style="background:#23c55e"></span><span data-i18n="legendGreen">Green=In‚ÄëHouse</span></span>
    <span class="chip"><span class="sw" style="background:#fbbf24"></span><span data-i18n="legendYellow">Yellow=Reserved</span></span>
    <span class="chip"><span class="sw" style="background:#ef4444"></span><span data-i18n="legendRed">Red=Dirty</span></span>
    <span class="chip"><span class="sw" style="background:#6b7280"></span><span data-i18n="legendGray">Gray=Vacant</span></span>
    <span class="chip"><span class="sw" style="background:#a855f7"></span><span data-i18n="legendPurple">Purple=Out of Order</span></span>
  </div>
  <div class="sp"></div>
  <button id="langBtn" class="btn-outline" data-i18n="langSwitch">AR / EN</button>
  <button id="newBtn" class="btn">+ Add / Assign</button>
  <button id="logoutBtn" class="btn-outline" data-i18n="signout">Sign out</button>
</header>

<section class="grid" id="board"></section>

<dialog id="dlg">
  <div class="hd">
    <div id="dlgTitle">Room</div>
    <button id="xBtn" class="btn-outline">√ó</button>
  </div>
  <form id="frm">
    <div>
      <label>Room</label>
      <input name="roomNumber" required placeholder="101">
    </div>
    <div>
      <label data-i18n="status">Status</label>
      <select name="status">
        <option value="gray">Vacant</option>
        <option value="yellow">Reserved</option>
        <option value="green">In‚ÄëHouse</option>
        <option value="red">Dirty</option>
        <option value="purple">Out of Order</option>
      </select>
    </div>
    <div>
      <label data-i18n="guest">Guest</label>
      <input name="guest" placeholder="Full name">
    </div>
    <div>
      <label data-i18n="phone">Phone</label>
      <input name="phone" placeholder="+964">
    </div>
    <div>
      <label data-i18n="car">Car No.</label>
      <input name="car" placeholder="plate">
    </div>
    <div>
      <label data-i18n="persons">Persons</label>
      <input type="number" min="1" value="1" name="persons">
    </div>
    <div>
      <label data-i18n="nights">Nights</label>
      <input type="number" min="1" value="1" name="nights">
    </div>
    <div>
      <label data-i18n="rate">Rate (IQD)</label>
      <input type="number" min="0" step="1000" value="0" name="rate">
    </div>
    <div>
      <label data-i18n="paid">Paid?</label>
      <select name="paid">
        <option value="unpaid">Unpaid</option>
        <option value="paid">Paid</option>
      </select>
    </div>
    <div>
      <label data-i18n="method">Method</label>
      <select name="method">
        <option>Cash</option>
        <option>Card</option>
        <option>Bank</option>
      </select>
    </div>
    <div class="full">
      <label data-i18n="notes">Notes</label>
      <textarea name="notes" rows="2"></textarea>
    </div>
    <div class="full">
      <strong>Total IQD: <span id="total">0</span> ‚Äî <span id="left">Unpaid</span></strong>
    </div>
  </form>
  <div class="right">
    <button id="invoiceBtn" class="btn-outline" data-i18n="invoice">Invoice</button>
    <button id="saveBtn" class="btn">Save</button>
  </div>
</dialog>

<script>
// ---------- Language (EN/AR) ----------
const i18n = {
  en:{legendGreen:"Green=In‚ÄëHouse", legendYellow:"Yellow=Reserved", legendRed:"Red=Dirty", legendGray:"Gray=Vacant", legendPurple:"Purple=Out of Order",
      langSwitch:"AR / EN", signout:"Sign out",
      status:"Status", guest:"Guest", phone:"Phone", car:"Car No.", persons:"Persons", nights:"Nights", rate:"Rate (IQD)", paid:"Paid?", method:"Method", notes:"Notes",
      paidWord:"Paid", unpaidWord:"Unpaid",
      invoiceTitle:"Invoice", desc:"Description", qty:"Qty", total:"Total", subtotal:"Subtotal", service:"Service", grand:"Grand Total", amountPaid:"Amount Paid", balance:"Balance Due", methodWord:"Method",
      inhouse:"In‚ÄëHouse", reserved:"Reserved", dirty:"Dirty", vacant:"Vacant", ooo:"Out of Order"},
  ar:{legendGreen:"ÿ£ÿÆÿ∂ÿ± = ÿØÿßÿÆŸÑ ÿßŸÑŸÅŸÜÿØŸÇ", legendYellow:"ÿ£ÿµŸÅÿ± = ŸÖÿ≠ÿ¨Ÿàÿ≤", legendRed:"ÿ£ÿ≠ŸÖÿ± = ÿ∫Ÿäÿ± ŸÜÿ∏ŸäŸÅ", legendGray:"ÿ±ŸÖÿßÿØŸä = ÿ¥ÿßÿ∫ÿ±", legendPurple:"ÿ®ŸÜŸÅÿ≥ÿ¨Ÿä = ÿÆÿßÿ±ÿ¨ ÿßŸÑÿÆÿØŸÖÿ©",
      langSwitch:"EN / AR", signout:"ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨",
      status:"ÿßŸÑÿ≠ÿßŸÑÿ©", guest:"ÿßŸÑÿßÿ≥ŸÖ", phone:"ÿßŸÑŸáÿßÿ™ŸÅ", car:"ÿ±ŸÇŸÖ ÿßŸÑÿ≥Ÿäÿßÿ±ÿ©", persons:"ÿßŸÑÿ£ÿ¥ÿÆÿßÿµ", nights:"ÿßŸÑŸÑŸäÿßŸÑŸä", rate:"ÿßŸÑÿ≥ÿπÿ± (ÿØŸäŸÜÿßÿ±)", paid:"ŸÖÿØŸÅŸàÿπÿü", method:"ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿØŸÅÿπ", notes:"ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™",
      paidWord:"ŸÖÿØŸÅŸàÿπ", unpaidWord:"ÿ∫Ÿäÿ± ŸÖÿØŸÅŸàÿπ",
      invoiceTitle:"ŸÅÿßÿ™Ÿàÿ±ÿ©", desc:"ÿßŸÑŸàÿµŸÅ", qty:"ÿßŸÑŸÉŸÖŸäÿ©", total:"ÿßŸÑŸÖÿ¨ŸÖŸàÿπ", subtotal:"ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä", service:"ÿßŸÑÿÆÿØŸÖÿ©", grand:"ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÉŸÑŸä", amountPaid:"ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÖÿØŸÅŸàÿπ", balance:"ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä", methodWord:"ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿØŸÅÿπ",
      inhouse:"ÿØÿßÿÆŸÑ ÿßŸÑŸÅŸÜÿØŸÇ", reserved:"ŸÖÿ≠ÿ¨Ÿàÿ≤", dirty:"ÿ∫Ÿäÿ± ŸÜÿ∏ŸäŸÅ", vacant:"ÿ¥ÿßÿ∫ÿ±", ooo:"ÿÆÿßÿ±ÿ¨ ÿßŸÑÿÆÿØŸÖÿ©"}
};
function getLang(){ return localStorage.getItem('subari_lang')||'en'; }
function setLang(l){ localStorage.setItem('subari_lang', l); applyLang(); }
function applyLang(){
  const L=getLang();
  document.documentElement.dir = (L==='ar')?'rtl':'ltr';
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const key=el.getAttribute('data-i18n');
    el.textContent = (i18n[L][key] || el.textContent);
  });
  render();
}
document.getElementById('langBtn').onclick=()=> setLang(getLang()==='en'?'ar':'en');
window.addEventListener('load', applyLang);

// ---------- Data ----------
const KEY='subari_rooms_v1';
let rooms = JSON.parse(localStorage.getItem(KEY)||'[]');
function save(){ localStorage.setItem(KEY, JSON.stringify(rooms)); }
function money(x){ return Number(x||0).toLocaleString('en-IQ'); }
function statusLabel(s){
  const L=getLang();
  const en={green:'In‚ÄëHouse', yellow:'Reserved', red:'Dirty', gray:'Vacant', purple:'Out of Order'};
  const ar={green:'ÿØÿßÿÆŸÑ ÿßŸÑŸÅŸÜÿØŸÇ', yellow:'ŸÖÿ≠ÿ¨Ÿàÿ≤', red:'ÿ∫Ÿäÿ± ŸÜÿ∏ŸäŸÅ', gray:'ÿ¥ÿßÿ∫ÿ±', purple:'ÿÆÿßÿ±ÿ¨ ÿßŸÑÿÆÿØŸÖÿ©'};
  return (L==='ar'?ar:en)[s]||s;
}

// ---------- Board ----------
const board = document.getElementById('board');
function colorOf(s){ return {green:'#052e1a',yellow:'#3d3006',red:'#3a0b0b',gray:'#1f242d',purple:'#2a0f3a'}[s]||'#1f242d'; }
function render(){
  board.innerHTML='';
  rooms.sort((a,b)=>(a.roomNumber||'').localeCompare(b.roomNumber||''));
  for(const r of rooms){
    const card = document.createElement('div'); card.className='card'; card.style.background=colorOf(r.status||'gray');
    const head = document.createElement('div'); head.className='row';
    head.innerHTML = `<div class="room-id">Room ${r.roomNumber||''}</div>
                      <div class="status">‚Ä¢ ${statusLabel(r.status||'gray')}</div>`;
    const row2 = document.createElement('div'); row2.className='row';
    if(r.guest){ row2.innerHTML += `<span class="tag">${r.guest}</span>`; }
    if(r.persons){ row2.innerHTML += `<span class="tag">üë• ${r.persons}</span>`; }
    if(r.nights){ row2.innerHTML += `<span class="tag">üõå ${r.nights}</span>`; }
    if(r.rate){ row2.innerHTML += `<span class="tag">üíµ ${money(r.rate)}</span>`; }
    const left = document.createElement('div'); left.className='foot';
    left.textContent = (getLang()==='ar') ? (r.paid==='paid'?'ŸÖÿØŸÅŸàÿπ':'ÿ∫Ÿäÿ± ŸÖÿØŸÅŸàÿπ') : (r.paid==='paid'?'Paid':'Unpaid');
    const btns = document.createElement('div'); btns.className='row';
    const edit = document.createElement('button'); edit.className='btn-outline'; edit.textContent='Open'; edit.onclick=()=>openDlg(r);
    const clean = document.createElement('button'); clean.className='btn-outline'; clean.textContent='Mark Clean'; clean.onclick=()=>{ r.status='gray'; save(); render(); };
    btns.append(edit, clean);
    card.append(head,row2,left,btns);
    board.append(card);
  }
}

// ---------- Dialog ----------
const dlg=document.getElementById('dlg');
const frm=document.getElementById('frm');
const total=document.getElementById('total');
const left=document.getElementById('left');
let current=null;

function openDlg(obj){
  current=obj || {status:'gray', persons:1, nights:1, rate:0, paid:'unpaid'};
  for(const el of frm.elements){ if(el.name){ el.value = current[el.name]??''; } }
  calc();
  dlg.showModal();
}
document.getElementById('newBtn').onclick=()=>openDlg(null);
document.getElementById('xBtn').onclick=()=>dlg.close();
frm.addEventListener('input', calc);

function calc(){
  const f=Object.fromEntries(new FormData(frm).entries());
  const nights=+f.nights||0, rate=+f.rate||0;
  const tot = nights*rate;
  total.textContent = money(tot);
  left.textContent = (getLang()==='ar') ? (f.paid==='paid'?'ŸÖÿØŸÅŸàÿπ':'ÿ∫Ÿäÿ± ŸÖÿØŸÅŸàÿπ') : (f.paid==='paid'?'Paid':'Unpaid');
}

document.getElementById('saveBtn').onclick=()=>{
  const f=Object.fromEntries(new FormData(frm).entries());
  if(!f.roomNumber) return alert('Room number is required');
  if(!current.id){ current.id=Date.now(); rooms.push(current); }
  Object.assign(current, f, {persons:+f.persons||1, nights:+f.nights||1, rate:+f.rate||0});
  save(); render(); dlg.close();
};

document.getElementById('invoiceBtn').onclick=()=>{
  const f=Object.fromEntries(new FormData(frm).entries());
  const L=getLang(), T=i18n[L];
  const nights=+f.nights||0, rate=+f.rate||0, tot=nights*rate;
  const html=`<html><head><meta charset="utf-8"><title>${T.invoiceTitle} ‚Äî Room ${f.roomNumber}</title>
  <style>body{font-family:system-ui;padding:24px} h1{margin:0 0 8px} table{width:100%;border-collapse:collapse}
  td,th{border:1px solid #ddd;padding:8px;text-align:${L==='ar'?'right':'left'}} .r{text-align:right}</style></head>
  <body dir="${L==='ar'?'rtl':'ltr'}">
  <h1>${T.invoiceTitle}</h1>
  <div>${f.guest||''}</div><div>Room ${f.roomNumber||''}</div><hr/>
  <table><thead><tr><th>${T.desc}</th><th>${T.qty}</th><th>${T.total}</th></tr></thead>
  <tbody><tr><td>${nights} night(s) @ ${money(rate)} IQD</td><td class="r">${nights}</td><td class="r">${money(tot)}</td></tr></tbody></table>
  <h3>${T.grand}: ${money(tot)} IQD</h3>
  <div>${T.amountPaid}: ${f.paid==='paid'? (L==='ar'?'ŸÖÿØŸÅŸàÿπ':'Paid') : (L==='ar'?'ÿ∫Ÿäÿ± ŸÖÿØŸÅŸàÿπ':'Unpaid')}</div>
  <div>${T.methodWord}: ${f.method||'-'}</div>
  </body></html>`;
  const w=window.open('about:blank','_blank'); w.document.write(html); w.document.close();
};

// ---------- Auth ----------
document.getElementById('logoutBtn').onclick=()=>{ localStorage.removeItem('subari_session_v1'); location.href='login.html'; };

// Seed some rooms if empty
if(rooms.length===0){ rooms=[{roomNumber:'101', status:'gray'},{roomNumber:'102', status:'red'},{roomNumber:'103', status:'yellow'}]; save(); }
render();
</script>
</body>
</html>
